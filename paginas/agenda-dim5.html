<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Agenda – Dimensão 5</title>
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet"/>
<style>
  body { font-family:'Lato', sans-serif; background:#f5f3db; margin:0; padding:0; }
  #calendario { max-width:900px; margin:40px auto; background:#fff; padding:10px; border-radius:10px; }
  #eventos-do-dia { max-width:900px; margin:20px auto; background:#fff; padding:20px; border-radius:10px; }
</style>
</head>
<body>
<h1 style="text-align:center;">Agenda – Dimensão 5 (Desenvolvimento)</h1>
<div id="calendario"></div>
<div id="eventos-do-dia"><h2>Evento(s) do dia</h2><p>Selecione uma data</p></div>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', async function () {
  const corDim5 = "#9467bd";
  const urlJSON = "eventos.json";

  function formatarDataPorExtenso(dataStr){
    const meses=['janeiro','fevereiro','março','abril','maio','junho','julho','agosto','setembro','outubro','novembro','dezembro'];
    const [ano,mes,dia]=dataStr.split("-");
    return parseInt(dia,10)+" de "+meses[parseInt(mes,10)-1]+" de "+ano;
  }

  function atualizarEventosDoDia(dateStr, base){
    const eventosDoDia = base.filter(e => e.date === dateStr && e.dimensao === 5);
    const container = document.getElementById('eventos-do-dia');
    const dataFmt = formatarDataPorExtenso(dateStr);
    if(eventosDoDia.length){
      container.innerHTML = `<h2>Evento(s) do dia</h2><p><strong>${dataFmt}</strong></p>` +
        eventosDoDia.map(e=>`<p><strong>${e.title}</strong>: ${e.description || ""}</p>`).join('');
    } else {
      container.innerHTML = `<h2>Evento(s) do dia</h2><p><strong>${dataFmt}</strong></p><p>Nenhum evento.</p>`;
    }
  }

  let eventosOriginais = [];
  try {
    const resp = await fetch(urlJSON, { cache: "no-store" });
    eventosOriginais = await resp.json();
  } catch (e) {
    console.error("Falha ao carregar eventos.json", e);
    eventosOriginais = [];
  }

  const eventosDim6 = eventosOriginais
    .filter(e => e.dimensao === 5)
    .map(e => ({
      title: e.title,
      start: e.date,
      end: e.end || undefined,
      description: e.description,
      backgroundColor: corDim6,
      borderColor: corDim6
    }));

  const calendarEl = document.getElementById('calendario');
  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    locale: 'pt-br',
    headerToolbar: { left:'prev,next today', center:'title', right:'dayGridMonth,timeGridWeek,listMonth' },
    buttonText: { today:'Hoje', month:'Mês', week:'Semana', day:'Dia', list:'Lista' },
    events: eventosDim6,
    dateClick: info => atualizarEventosDoDia(info.dateStr, eventosOriginais),
    eventClick: info => atualizarEventosDoDia(info.event.start.toISOString().split("T")[0], eventosOriginais)
  });
  calendar.render();
});
</script>
</body>
</html>
